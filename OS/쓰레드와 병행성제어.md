
### 쓰레드와 병행성 제어

쓰레드 : cpu 이용의 기본 단위
- 스레드 id , pc  레지스터 집합 , 스택으로 구성
- 같은 프로세스에 속학 다른 스레드와 코드 , 데이터 , 운영체제 자원들을 공유

전통적으로는 단일 스레드 프로세스로 작동했다면 최근의 많은 서비스는 다중스레드를 이용한다.
서버를 예를 들었을 때 서버가 단일 스레드 프로세스라면 하나의 요청이 들어오면 새로운 프로세스를 만들었다.

하지만 이것은 오버헤드도 크고 똑같은 일을 반복하게 될 때에는 비효율 적이므로 프로세스를 생성하는 것이 아니라 요청일 들어오면 해당 요청을 처리할 새로운 스레드를 생성하는 것이고 다른 요청을  listen할 새로운 스레드를 생성하는 것이다.

다중 스레드의 장점
- 응답성 : 응용프로그램이 긴 작업을 수행하더라도 프로그램의 수행이 계속되는 것을 허용함으로써 사용자에 대한 응답성 증가
- 자원 공유 : 프로세스는 공유 메모리와 메시지 전달 기법을 통하여 자원을 공유해야 하여 이를 프로그래머에 의해서 명시적으로 처리 되어야 한다. 하지만 스레드는 그들이 속한 프로세스의 자원들과 메로리를 공유한다.
- 경제성 : 새로운 프로세스를 위한 자우너할당이나 메모리의 비용이 줄고 프로세스 내에서 자원을 공유하기 때문에 문맥교환 또한 경제적이다. (셩험적으로 측정하는 것을 어렵다.)
- 규모 적응성 : 다음에 설명

점차 다중코어와 다중 스레드를 통한 프로그래밍은 효율적이지만 고려해야 하는 사항이  있다.
'병행성' 과 '병렬성'
병행 시스템 : 모든 작업이 진행되게 하여 둘 이상의 작업을 지원
병렬 시스템 : 둘 이상의 작업을 동시에 수행할 수 있다.

원래 단일 프로세서에서는 프로세스간의 전환을 통해 병렬성의 환상을 제공하였고 병행하였지만 병렬되지 않았다.

그럼 병렬되게 하려면? 다중 스레드를 사용하도록 설계해야 한다.

[Amdahl's law]
순차 실행과 구성 요소와 병렬 실행 구성 요소로 이뤄진 성능 계산 공식
쉽게 말하면 순차 실행관점에서는 코어의 수가 무한대에 가까워 질 수록 순차적으로 실행되어야 하는 부분을 성능향상에 불균형적인 영향을 미친다.

극복과제 5가지
- 태스크 인식 : 분석하여 병행 가능 태스크로 나눌 수 있는 영역을 찾아야 한다.
- 균형 : 병렬로 실행될 수 있는 태스크를 찾는 것만큼 전체 작업에 균등한 기여도를 가지도록 하는 것도 중요하다.
- 데이터 분리 : 태스크가 접근하고 조작하는 데이터 또한 개별 코어에서 사용할 수 있어야 한다.
