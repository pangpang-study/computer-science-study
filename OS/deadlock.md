## 데드락이란?

> 빼도박도 못하는 상황

- 멀티 프로그래밍에서 두 프로세스/쓰레드가 서로 얻고 싶은 자원을 서로가 갖고 있어 포기하지 못하고 무한루프에 갇혀 버리는 교착상태
- 그래서 결국 둘 다 일을 못하게 되는 상태

## 데드락 발생 조건

1. 상호 배제(mutex): 프로세스들이 필요로 하는 자원에 대해 배타적인 통제권을 요구
2. 점유-대기(hold-and-wait): 프로세스가 할당된 자원을 가진 상태에서 다른 자원을 기다림
3. 비선점(No Preemption): 락을 강제로 포기시킬 수 없는 것. cpu 선점과 다름.
4. 순환 대기(circular wait): 각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 갖고 있음

## 해결 방법

1. 교착상태가 아예 발생하지 않도록 하는 것
    - 예방(Prevention): 데드락이 생기지 않게 미리 예방.
        - 철학자의 밥상의 경우, 한명의 철학자는 반대 방향으로 포크를 잡게 한다거나.
        - 즉, 프로그래머가 "예방"할 수 있도록 코드를 짜는 것.
    - 회피(Avoidance): 리소스 측면에서 예방. 즉, 데드락이 발생할 것 같은 메모리 할당을 하지 않는다.
        - 예를 들어, 철학자 밥상의 경우 의자가 5개라면 철학자를 5명이 아니라 최대 4명만 앉도록 하는 것.
        - **은행원 알고리즘**
2. 교착 상태가 탐지되면 복구
    - 탐색 후 초지(Detection and Recovery): 일단 데드락이 생기면 그 떄 처리하는 방법
        - 체크포인트(Checkpoint) & 롤백(Rollback): 자원을 할당할 때마다 체크포인트 설정. 자원의 상태를 기록, 데드락 발생시 복구
        - Kill Process: 문제가 되는 프로세스 하나를 죽이고 다시 실행.(철학자 아저씨 하나를 밥상에서 내쫓음)
3. 교착상태 무시(Ignore)
    - 교착 상태가 거의 발생하지 않는 프로그램에서 예외 처리를 포기하고 성능을 택하는 것.
    - 교착상태를 잡기 위해서는 예외처리의 오버헤드가 필요하다. 이 점에서 성능의 이점을 가져오고, 교착상태가 발생하면 프로그램을 재부팅.

### 은행원 알고리즘(Banker's Algorithms)

- 안전 순서열(Safe Sequence): 자원을 각 프로세스에게 순서대로 나누어줄 때 데드락이 발생하지 않도록 하는 순서.
    - 각 프로세스의 최대 자원 요구량
    - 각 프로세스의 현재 사용하는 자원량
    - 시스템이 보유한 사용가능한 자원량
- 안전상태(Safe State): 안전 순서열이 존재하는 상태
- 불안전상태(Unsafe State): 안전순서열이 존재하지 않는 상태
- 안전 순서열을 만족할 때만 그 순서대로 프로세스에게 자원을 할당

**문제점**

- 자원 사용률이 너무 낮다. → 항상 안전상태를 유지해야 하기 때문에.
- 최대 자원 요구량을 알아야 한다.
- 프로세스 개수가 일정해야 함.
- 등의 이유로 현재엔 사용하고 있지 않음.
